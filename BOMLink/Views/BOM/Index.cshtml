@model BOMLink.ViewModels.BOMViewModel

@{
    ViewData["Title"] = "Bill of Materials";
}

<div class="container-fluid mt-4">
    <div class="row">
        <!-- Sidebar Section -->
        <aside class="col-md-3">
            <div class="card shadow-sm p-3">
                <h5 class="fw-bold">Actions</h5>
                <a href="@Url.Action("Create", "BOM")" class="btn btn-outline-primary w-100 mb-2">Add BOM</a>
            </div>
        </aside>

        <!-- Main Content Section -->
        <main class="col-md-9">
            <h2>Bill of Materials</h2>

            <!-- Search & Filter -->
            <form method="get" class="mb-3">
                <div class="row">
                    <!-- Search Box -->
                    <div class="col-md-4 mb-2">
                        <input type="text" name="searchTerm" class="form-control" placeholder="Search by Description or Job" value="@Model.SearchTerm">
                    </div>

                    <!-- Filter by Customer Code -->
                    <div class="col-md-3 mb-2">
                        <select name="customerCodeFilter" class="form-select">
                            <option value="">All Customers</option>
                            @foreach (var customerCode in Model.AvailableCustomers)
                            {
                                <option value="@customerCode" selected="@(Model.CustomerCodeFilter == customerCode ? "selected" : null)">@customerCode</option>
                            }
                        </select>
                    </div>

                    <!-- Filter by Created By -->
                    <div class="col-md-3 mb-2">
                        <select name="createdByFilter" class="form-select">
                            <option value="">All Users</option>
                            @foreach (var user in Model.AvailableUsers)
                            {
                                <option value="@user" selected="@(Model.CreatedByFilter == user ? "selected" : null)">@user</option>
                            }
                        </select>
                    </div>

                    <!-- Search Button -->
                    <div class="col-md-2">
                        <button type="submit" class="btn btn-outline-secondary w-100">Search</button>
                    </div>
                </div>
            </form>

            <!-- BOM Table -->
            <table class="table mt-3">
                <thead class="table-light">
                    <tr>
                        <th>
                            <a href="@Url.Action("Index", new { sortBy = "job", sortOrder = Model.SortBy == "job" && Model.SortOrder == "asc" ? "desc" : "asc", searchTerm = Model.SearchTerm })">
                                Job
                            </a>
                        </th>
                        <th>
                            <a href="@Url.Action("Index", new { sortBy = "description", sortOrder = Model.SortBy == "description" && Model.SortOrder == "asc" ? "desc" : "asc", searchTerm = Model.SearchTerm })">
                                Description
                            </a>
                        </th>
                        <th>
                            <a href="@Url.Action("Index", new { sortBy = "status", sortOrder = Model.SortBy == "status" && Model.SortOrder == "asc" ? "desc" : "asc", searchTerm = Model.SearchTerm })">
                                Status
                            </a>
                        </th>
                        <th>
                            <a href="@Url.Action("Index", new { sortBy = "version", sortOrder = Model.SortBy == "version" && Model.SortOrder == "asc" ? "desc" : "asc", searchTerm = Model.SearchTerm })">
                                Version
                            </a>
                        </th>
                        <th>
                            <a href="@Url.Action("Index", new { sortBy = "createdBy", sortOrder = Model.SortBy == "createdBy" && Model.SortOrder == "asc" ? "desc" : "asc", searchTerm = Model.SearchTerm })">
                                Created By
                            </a>
                        </th>
                        <th>
                            <a href="@Url.Action("Index", new { sortBy = "updatedAt", sortOrder = Model.SortBy == "updatedAt" && Model.SortOrder == "asc" ? "desc" : "asc", searchTerm = Model.SearchTerm })">
                                Last Updated
                            </a>
                        </th>
                        <th class="text-end">Actions</th>
                    </tr>
                </thead>
                <tbody>
                    @foreach (var bom in Model.BOMs)
                    {
                        <tr>
                            <td>@(bom.JobNumber != "N/A" ? bom.JobNumber : $"Customer: {bom.CustomerCode}")</td>
                            <td>@bom.Description</td>
                            <td>
                                <span class="badge @(bom.Status == "Draft" ? "bg-secondary"
                                                : bom.Status == "PendingApproval" ? "bg-primary"
                                                : bom.Status == "Approved" ? "bg-success"
                                                : "bg-danger")">
                                    @bom.Status
                                </span>
                            </td>
                            <td>@bom.VersionFormatted</td>
                            <td>@bom.CreatedBy</td>
                            <td>@bom.UpdatedAt.ToLocalTime().ToString("g")</td>
                            <td class="text-end">
                                <!-- View BOM Items -->
                                <a href="@Url.Action("ViewItems", "BOM", new { id = bom.Id })" class="text-info me-3" data-bs-toggle="tooltip" title="View Items">
                                    <i class="fa-solid fa-box-open"></i>
                                </a>

                                <!-- Edit BOM -->
                                <a href="@Url.Action("Edit", "BOM", new { id = bom.Id })" class="text-warning me-3" data-bs-toggle="tooltip" title="Edit">
                                    <i class="fa-solid fa-edit"></i>
                                </a>

                                <!-- Delete BOM -->
                                <a href="@Url.Action("Delete", "BOM", new { id = bom.Id })" class="text-danger" data-bs-toggle="tooltip" title="Delete">
                                    <i class="fa-solid fa-trash"></i>
                                </a>
                            </td>
                        </tr>
                    }
                </tbody>
            </table>
        </main>
    </div>
</div>